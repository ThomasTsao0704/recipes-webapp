<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç¾é£Ÿé£Ÿè­œç€è¦½</title>

    <!-- å¤–æ›ï¼šPapaParse ä¾› CSV è§£æ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>

    <!-- ä½ çš„æ¨£å¼ -->
    <link rel="stylesheet" href="style.css" />

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
</head>

<body>
    <header class="topbar">
        <div class="brand">é£Ÿè­œ WebApp</div>
        <div class="actions">
            <button id="btnPickFolder" class="btn btn-accent" type="button">é¸æ“‡è³‡æ–™å¤¾</button>
            <button id="btnWriteCSV" class="btn btn-accent" type="button">å¯«å…¥ recipes.csv</button>
            <button id="btnExport" class="btn btn-accent" type="button">åŒ¯å‡º CSV</button>
        </div>
    </header>

    <div class="container">
        <header>
            <h1>ğŸ³ ç¾é£Ÿé£Ÿè­œç€è¦½</h1>
            <p class="subtitle">æ¢ç´¢ç¾å‘³é£Ÿè­œï¼Œäº«å—æ–™ç†æ™‚å…‰</p>
            <nav class="nav-tabs">
                <button class="nav-btn active" data-page="browse" type="button">ğŸ“– ç€è¦½é£Ÿè­œ</button>
                <button class="nav-btn" data-page="add" type="button">â• æ–°å¢é£Ÿè­œ</button>
            </nav>
        </header>

        <!-- ç€è¦½å€ -->
        <div class="page active" id="browsePage">
            <div class="filters">
                <div class="filter-row">
                    <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹é£Ÿè­œã€é£Ÿææˆ–æ¨™ç±¤..." />
                    <select id="categorySelect">
                        <option value="">ğŸ“‹ å…¨éƒ¨åˆ†é¡</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="grid" type="button">ç¶²æ ¼</button>
                        <button class="view-btn" data-view="list" type="button">åˆ—è¡¨</button>
                    </div>
                </div>
            </div>

            <div class="stats" id="stats">è¼‰å…¥ä¸­...</div>

            <div id="recipesContainer" class="recipes-grid">
                <div class="loading">æ­£åœ¨è¼‰å…¥é£Ÿè­œè³‡æ–™</div>
            </div>
        </div>

        <!-- æ–°å¢å€ -->
        <div class="page" id="addPage">
            <div class="add-recipe-form">
                <div class="success-message" id="successMessage">âœ… é£Ÿè­œæ–°å¢æˆåŠŸï¼</div>

                <form id="addRecipeForm">
                    <div class="form-section">
                        <h3>ğŸ“ åŸºæœ¬è³‡è¨Š</h3>
                        <div class="form-group">
                            <label for="recipeTitle">é£Ÿè­œåç¨± *</label>
                            <input type="text" id="recipeTitle" required placeholder="ä¾‹å¦‚ï¼šç•ªèŒ„è‚‰é†¬ç¾©å¤§åˆ©éºµ" />
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipeCategory">åˆ†é¡</label>
                                <select id="recipeCategory">
                                    <option value="">é¸æ“‡åˆ†é¡</option>
                                    <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
                                    <option value="ä¸­å¼">ä¸­å¼</option>
                                    <option value="æ—¥å¼">æ—¥å¼</option>
                                    <option value="éŸ“å¼">éŸ“å¼</option>
                                    <option value="è¥¿å¼">è¥¿å¼</option>
                                    <option value="æ³°å¼">æ³°å¼</option>
                                    <option value="æ¹¯å“">æ¹¯å“</option>
                                    <option value="æ²™æ‹‰">æ²™æ‹‰</option>
                                    <option value="ç”œé»">ç”œé»</option>
                                    <option value="é£²å“">é£²å“</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="recipeServings">ä»½é‡</label>
                                <input type="number" id="recipeServings" min="1" placeholder="äººä»½" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prepTime">æº–å‚™æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                                <input type="number" id="prepTime" min="0" placeholder="15" />
                            </div>
                            <div class="form-group">
                                <label for="cookTime">çƒ¹é£ªæ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                                <input type="number" id="cookTime" min="0" placeholder="30" />
                            </div>
                            <div class="form-group">
                                <label for="calories">ç†±é‡ï¼ˆå¡è·¯é‡Œï¼‰</label>
                                <input type="number" id="calories" min="0" placeholder="500" />
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ğŸ·ï¸ æ¨™ç±¤</h3>
                        <div class="tags-input">
                            <input type="text" id="tagsInput" placeholder="è¼¸å…¥æ¨™ç±¤å¾ŒæŒ‰ Enterï¼ˆä¾‹å¦‚ï¼šå®¶å¸¸èœï¼‰" />
                            <div class="tags-display" id="tagsDisplay"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ğŸ¥¬ é£Ÿææ¸…å–®</h3>
                        <div class="ingredients-list" id="ingredientsList">
                            <div class="ingredient-item">
                                <input type="text" placeholder="ä¾‹å¦‚ï¼šç¾©å¤§åˆ©éºµ 200g" required />
                                <button type="button" class="remove-btn"
                                    onclick="app.removeIngredient(this)">ç§»é™¤</button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="app.addIngredient()">â• æ–°å¢é£Ÿæ</button>
                    </div>

                    <div class="form-section">
                        <h3>ğŸ‘¨â€ğŸ³ è£½ä½œæ­¥é©Ÿ</h3>
                        <div class="steps-list" id="stepsList">
                            <div class="step-item">
                                <span style="font-weight: bold; min-width: 30px;">1.</span>
                                <input type="text" placeholder="è©³ç´°æè¿°ç¬¬ä¸€å€‹æ­¥é©Ÿ" required />
                                <button type="button" class="remove-btn" onclick="app.removeStep(this)">ç§»é™¤</button>
                            </div>
                        </div>
                        <button type="button" class="add-btn" onclick="app.addStep()">â• æ–°å¢æ­¥é©Ÿ</button>
                    </div>

                    <div class="form-section">
                        <h3>ğŸ–¼ï¸ ä¸Šå‚³åœ–ç‰‡ï¼ˆé¸å¡«ï¼‰</h3>
                        <div class="form-group">
                            <label for="recipeImageFile">é¸æ“‡åœ–ç‰‡æª”æ¡ˆ</label>
                            <input type="file" id="recipeImageFile" accept="image/*" />
                            <div id="addImagePreview" style="margin-top: 12px;"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="app.clearForm()">æ¸…ç©ºè¡¨å–®</button>
                        <button type="submit" class="btn btn-primary">ğŸ’¾ å„²å­˜é£Ÿè­œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ä½ çš„è…³æœ¬ -->
    <script src="data.js" defer></script>
    <script src="app.js" defer></script>

    <aside id="editDrawer" class="drawer hidden" aria-hidden="true">
        <div class="drawer-header">
            <h3>ç·¨è¼¯é£Ÿè­œ</h3>
            <button id="closeDrawer" class="btn btn-secondary" type="button">é—œé–‰</button>
        </div>
        <form id="editForm" class="edit-form">
            <label>æ¨™é¡Œ</label>
            <input name="title" type="text" required>
            <label>åˆ†é¡</label>
            <input name="category" type="text">
            <label>æ¨™ç±¤ï¼ˆåˆ†è™Ÿåˆ†éš”ï¼‰</label>
            <input name="tags" type="text">
            <label>é£Ÿæï¼ˆæ¯é …ä»¥ | åˆ†éš”ï¼‰</label>
            <textarea name="ingredients" rows="3"></textarea>
            <label>æ­¥é©Ÿï¼ˆå¤šè¡Œï¼‰</label>
            <textarea name="steps" rows="5"></textarea>
            <div class="grid-2">
                <div>
                    <label>æº–å‚™ï¼ˆåˆ†é˜ï¼‰</label>
                    <input name="prep_minutes" type="number" min="0">
                </div>
                <div>
                    <label>çƒ¹èª¿ï¼ˆåˆ†é˜ï¼‰</label>
                    <input name="cook_minutes" type="number" min="0">
                </div>
            </div>
            <div class="grid-2">
                <div>
                    <label>ä»½é‡</label>
                    <input name="servings" type="number" min="1">
                </div>
                <div>
                    <label>å¡è·¯é‡Œ</label>
                    <input name="calories" type="number" min="0">
                </div>
            </div>
            <label>åœ–ç‰‡ç¶²å€æˆ–ä¸Šå‚³æ–°åœ–ç‰‡</label>
            <!-- æ”¹ç‚º textï¼Œå®¹è¨±ç›¸å°è·¯å¾‘ / dataURL / blob: ObjectURL -->
            <input name="image_url" type="text" placeholder="ç¾æœ‰åœ–ç‰‡ç¶²å€æˆ–ç›¸å°è·¯å¾‘">
            <input id="imageFile" name="image_file" type="file" accept="image/*">
            <div id="imagePreview" style="margin:8px 0;"></div>
            <div class="drawer-actions">
                <!-- é¿å…é è¨­ submit é€ æˆæ•´é é‡æ•´ -->
                <button id="saveRecipe" class="btn" type="button">å„²å­˜</button>
                <button id="deleteRecipe" class="btn btn-danger" type="button">åˆªé™¤</button>
            </div>
        </form>
    </aside>

    <script>
        (function () {
            function registerSW() {
                if ("serviceWorker" in navigator) {
                    // ç¢ºä¿ä½ çš„å°ˆæ¡ˆä¸­å­˜åœ¨ / åŒåçš„ sw.js
                    navigator.serviceWorker.register("./sw.js").catch(console.error);
                }
            }
            function onceReady(fn) {
                if (document.readyState !== "loading") fn();
                else document.addEventListener("DOMContentLoaded", fn);
            }
            onceReady(registerSW);
        })();

        // å¯åŠæ€§å‹å–„ï¼šç¤ºç¯„å¦‚ä½•åŒæ­¥ aria-hiddenï¼ˆä½ çš„ app.js ä¹Ÿèƒ½å‘¼å«ï¼‰
        window.drawerA11y = {
            open() {
                const d = document.getElementById('editDrawer');
                d.classList.remove('hidden');
                d.setAttribute('aria-hidden', 'false');
            },
            close() {
                const d = document.getElementById('editDrawer');
                d.classList.add('hidden');
                d.setAttribute('aria-hidden', 'true');
            }
        };
    </script>
</body>

</html>